#!/usr/bin/env python

import boto


sqs = boto.connect_sqs()

queue = sqs.create_queue('my-queue', visibility_timeout=5)

iam = boto.connect_iam()
user_response = iam.create_user('my-user')
key_response = iam.create_access_key('my-user')

access_key = key_response['create_access_key_response']['create_access_key_result']['access_key']
print 'access_key: %s' % access_key['access_key_id']
print 'secret_key: %s' % access_key['secret_access_key']

policy_json = """{
  "Statement": [
    {
      "Action": [
        "sqs:SendMessage"
      ],
      "Effect": "Allow",
      "Resource": [
        "%s"
      ]
    }
  ]
}""" % queue.get_attributes('QueueArn')['QueueArn']

policy = iam.put_user_policy('my-user', 'my-user-sqs-policy', policy_json)
